(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{685:function(e,t,s){"use strict";s.r(t);var a=s(44),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化"}},[e._v("#")]),e._v(" 优化")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("优化")]),e._v(" "),s("p",[e._v("优化分两个场景：开发环境、生产环境")])]),e._v(" "),s("h2",{attrs:{id:"通用环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通用环境"}},[e._v("#")]),e._v(" 通用环境")]),e._v(" "),s("h3",{attrs:{id:"_1-loader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-loader"}},[e._v("#")]),e._v(" 1. loader")]),e._v(" "),s("p",[e._v("将 loader 应用于最少数量的必要模块。通过使用 "),s("code",[e._v("include")]),e._v(" 字段，仅将 loader 应用在实际需要将其转换的模块")]),e._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[e._v("const path = require('path');\n\nmodule.exports = {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" //...\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" module: {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   rules: [\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("     {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("       test: /\\.js$/,\n")])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("       include: path.resolve(__dirname, 'src'),\n")])]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("       loader: 'babel-loader',\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("     },\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   ],\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" },\n")])]),e._v("};\n\n")])])]),s("h3",{attrs:{id:"_2-引导-bootstrap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-引导-bootstrap"}},[e._v("#")]),e._v(" 2. 引导(bootstrap)")]),e._v(" "),s("p",[e._v("每个额外的 loader/plugin 都有其启动时间。尽量少地使用工具。")]),e._v(" "),s("h3",{attrs:{id:"_3-解析-resolve"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-解析-resolve"}},[e._v("#")]),e._v(" 3. 解析(resolve)")]),e._v(" "),s("p",[e._v("以下步骤可以提高解析速度：")]),e._v(" "),s("ul",[s("li",[e._v("减少 "),s("code",[e._v("resolve.modules")]),e._v(", "),s("code",[e._v("resolve.extensions")]),e._v(", "),s("code",[e._v("resolve.mainFiles")]),e._v(", "),s("code",[e._v("resolve.descriptionFiles")]),e._v(" 中条目数量，因为他们会增加文件系统调用的次数。")]),e._v(" "),s("li",[e._v("如果你不使用 symlinks（例如 "),s("code",[e._v("npm link")]),e._v(" 或者 "),s("code",[e._v("yarn link")]),e._v("），可以设置 "),s("code",[e._v("resolve.symlinks: false")]),e._v("。")]),e._v(" "),s("li",[e._v("如果你使用自定义 resolve plugin 规则，并且没有指定 context 上下文，可以设置 "),s("code",[e._v("resolve.cacheWithContext: false")]),e._v("。")])]),e._v(" "),s("h3",{attrs:{id:"_4-dll"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-dll"}},[e._v("#")]),e._v(" 4. dll")]),e._v(" "),s("p",[e._v("使用 "),s("code",[e._v("DllPlugin")]),e._v(" 为更改不频繁的代码生成单独的编译结果。这可以提高应用程序的编译速度，尽管它增加了构建过程的复杂度。")]),e._v(" "),s("h2",{attrs:{id:"开发环境优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开发环境优化"}},[e._v("#")]),e._v(" 开发环境优化")]),e._v(" "),s("h3",{attrs:{id:"_1-自动编译代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-自动编译代码"}},[e._v("#")]),e._v(" 1.自动编译代码")]),e._v(" "),s("blockquote",[s("p",[e._v("每次编译代码时，要手动 "),s("code",[e._v("npm run build")]),e._v("会显得很麻烦。webpack提供了几种可选方式，帮助你在代码发生变化后**"),s("a",{attrs:{href:"https://webpack.docschina.org/guides/development/#choosing-a-development-tool",target:"_blank",rel:"noopener noreferrer"}},[e._v("自动编译代码"),s("OutboundLink")],1),e._v("**：")])]),e._v(" "),s("ul",[s("li",[e._v("webpck的 watch model（增量编译）")]),e._v(" "),s("li",[e._v("webpack-dev-server（内存编译 - 推荐）")]),e._v(" "),s("li",[e._v("webpack-dev-middleware")])]),e._v(" "),s("h4",{attrs:{id:"a-webpack-watch-mode-观察模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#a-webpack-watch-mode-观察模式"}},[e._v("#")]),e._v(" a. webpack watch mode(观察模式)")]),e._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[e._v("{\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(' "scripts": {\n')]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('     "build": "webpack",\n')])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('     "watch": "webpack --watch"\n')])]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" }\n")])]),e._v("}\n")])])]),s("ul",[s("li",[e._v("缺点：为了看到修改后的实际效果，需要刷新浏览器。")])]),e._v(" "),s("h4",{attrs:{id:"b-webpack-dev-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#b-webpack-dev-server"}},[e._v("#")]),e._v(" b. webpack-dev-server")]),e._v(" "),s("p",[s("code",[e._v("webpack-dev-server")]),e._v("为你提供了一个简单的 "),s("strong",[e._v("web server")]),e._v("，并且具有 "),s("code",[e._v("live reloading（实时重新加载）")]),e._v("功能。设置如下：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" i webpack-dev-server -D\n")])])]),s("p",[e._v("修改配置文件，告知"),s("code",[e._v("dev server")]),e._v("从什么位置查找文件：")]),e._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[e._v("// webpack.config.js\nmodule.exports = {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" mode: 'development',\n")])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" devServer: {\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   contentBase: './dist',\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" }\n")])]),e._v("}\n")])])]),s("p",[e._v("以上配置告知 "),s("code",[e._v("webpack-dev-server")]),e._v("，将"),s("code",[e._v("dist")]),e._v(" 目录下的文件 "),s("code",[e._v("serve")]),e._v(" 到 "),s("code",[e._v("localhost:8080")]),e._v(" 下。")]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[e._v("webpack-dev-server 在编译之后不会写入到任何输出文件。而是"),s("strong",[e._v("将 bundle 文件保留在内存中")]),e._v("，然后将它们 serve 到 server 中，就好像它们是挂载在 server 根路径上的真实文件一样。如果你的页面希望在其他不同路径中找到 bundle 文件，则可以通过 dev server 配置中的 "),s("a",{attrs:{href:"https://webpack.docschina.org/configuration/dev-server/#devserverpublicpath-",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("publicPath")]),s("OutboundLink")],1),e._v(" 选项进行修改。")])]),e._v(" "),s("p",[e._v("我们添加一个可以直接运行 dev server 的 script：")]),e._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[e._v("{\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(' "scripts": {\n')]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('     "build": "webpack",\n')]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('     "watch": "webpack --watch"\n')])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('     "start": "webpack serve --open"\n')])]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" }\n")])]),e._v("}\n")])])]),s("p",[s("code",[e._v("webpack-dev-server")]),e._v(" 具有许多可配置的选项。关于其他更多配置，请查看 "),s("a",{attrs:{href:"https://webpack.docschina.org/configuration/dev-server",target:"_blank",rel:"noopener noreferrer"}},[e._v("配置文档"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("现在，server 正在运行，你可能需要尝试 "),s("a",{attrs:{href:"https://webpack.docschina.org/guides/hot-module-replacement",target:"_blank",rel:"noopener noreferrer"}},[e._v("模块热替换(hot module replacement)"),s("OutboundLink")],1),e._v("！")])]),e._v(" "),s("p",[e._v("模块热替换(hot module replacement 或 HMR)是 webpack 提供的最有用的功能之一。它允许在运行时更新所有类型的模块，而无需完全刷新。我们要做的就是更新 "),s("a",{attrs:{href:"https://github.com/webpack/webpack-dev-server",target:"_blank",rel:"noopener noreferrer"}},[e._v("webpack-dev-server"),s("OutboundLink")],1),e._v(" 配置， 然后使用 webpack 内置的 HMR 插件。")]),e._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[e._v("// webpack.config.js\nmodule.exports = {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" mode: 'development',\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" devServer: {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   contentBase: './dist',\n")])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   hot: true,\n")])]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" }\n")])]),e._v("}\n")])])]),s("h4",{attrs:{id:"c-webpack-dev-middleware-中间件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#c-webpack-dev-middleware-中间件"}},[e._v("#")]),e._v(" c.webpack-dev-middleware 中间件")]),e._v(" "),s("p",[s("code",[e._v("webpack-dev-middleware")]),e._v(" 是一个封装器(wrapper)，它可以把 webpack 处理过的文件发送到一个 server。"),s("code",[e._v("webpack-dev-server")]),e._v(" 在内部使用了它，然而它也可以作为一个单独的 package 来使用，以便根据需求进行更多自定义设置。")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://webpack.docschina.org/guides/development/#using-webpack-dev-middleware",target:"_blank",rel:"noopener noreferrer"}},[e._v("webpack-dev-middleware"),s("OutboundLink")],1),e._v("中间件配合 express server使用")]),e._v(" "),s("h2",{attrs:{id:"生产环境优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生产环境优化"}},[e._v("#")]),e._v(" 生产环境优化")]),e._v(" "),s("h3",{attrs:{id:"_1-代码分离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-代码分离"}},[e._v("#")]),e._v(" 1. 代码分离")]),e._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://webpack.docschina.org/guides/code-splitting/",target:"_blank",rel:"noopener noreferrer"}},[e._v("代码分离"),s("OutboundLink")],1),e._v("是 webpack 中最引人注目的特性之一。此特性能够把代码分离到不同的 bundle 中，然后可以按需加载或并行加载这些文件。代码分离可以用于获取更小的 bundle，以及控制资源加载优先级，如果使用合理，会极大影响加载时间。")])]),e._v(" "),s("p",[e._v("常用的代码分离方法有三种：")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("入口起点")]),e._v("：使用 "),s("a",{attrs:{href:"https://webpack.docschina.org/configuration/entry-context",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("entry")]),s("OutboundLink")],1),e._v(" 配置手动地分离代码。")]),e._v(" "),s("li",[s("strong",[e._v("防止重复")]),e._v("：使用 "),s("a",{attrs:{href:"https://webpack.docschina.org/configuration/entry-context/#dependencies",target:"_blank",rel:"noopener noreferrer"}},[e._v("Entry dependencies"),s("OutboundLink")],1),e._v(" 或者 "),s("a",{attrs:{href:"https://webpack.docschina.org/plugins/split-chunks-plugin",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("SplitChunksPlugin")]),s("OutboundLink")],1),e._v(" 去重和分离 chunk。")]),e._v(" "),s("li",[s("strong",[e._v("动态导入")]),e._v("：通过模块的内联函数调用来分离代码。")])]),e._v(" "),s("h4",{attrs:{id:"splitchunksplugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#splitchunksplugin"}},[e._v("#")]),e._v(" SplitChunksPlugin")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://webpack.docschina.org/plugins/split-chunks-plugin",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("SplitChunksPlugin")]),s("OutboundLink")],1),e._v(" 插件可以将公共的依赖模块提取到已有的入口 chunk 中，或者提取到一个新生成的 chunk。让我们使用这个插件，将之前的示例中重复的 "),s("code",[e._v("lodash")]),e._v(" 模块去除：")]),e._v(" "),s("p",[s("strong",[e._v("webpack.config.js")])]),e._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" const path = require('path');\n")])]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" module.exports = {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   mode: 'development',\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   entry: {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("     index: './src/index.js',\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("     another: './src/another-module.js',\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   },\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   output: {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("     filename: '[name].bundle.js',\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("     path: path.resolve(__dirname, 'dist'),\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   },\n")])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   optimization: {\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("     splitChunks: {\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("       chunks: 'all',\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("     },\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   },\n")])]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" };\n")])])])])]),s("p",[e._v("使用 "),s("a",{attrs:{href:"https://webpack.docschina.org/plugins/split-chunks-plugin/#optimization-splitchunks",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("optimization.splitChunks")]),s("OutboundLink")],1),e._v(" 配置选项之后，现在应该可以看出，"),s("code",[e._v("index.bundle.js")]),e._v(" 和 "),s("code",[e._v("another.bundle.js")]),e._v(" 中已经移除了重复的依赖模块。需要注意的是，插件将 "),s("code",[e._v("lodash")]),e._v(" 分离到单独的 chunk，并且将其从 main bundle 中移除，减轻了大小。")]),e._v(" "),s("h4",{attrs:{id:"bundle-分析-bundle-analysis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bundle-分析-bundle-analysis"}},[e._v("#")]),e._v(" bundle 分析(bundle analysis)")]),e._v(" "),s("p",[e._v("一旦开始分离代码，一件很有帮助的事情是，分析输出结果来检查模块在何处结束。 "),s("a",{attrs:{href:"https://github.com/webpack/analyse",target:"_blank",rel:"noopener noreferrer"}},[e._v("官方分析工具"),s("OutboundLink")],1),e._v(" 是一个不错的开始。还有一些其他社区支持的可选项：")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://alexkuz.github.io/webpack-chart/",target:"_blank",rel:"noopener noreferrer"}},[e._v("webpack-chart"),s("OutboundLink")],1),e._v(": webpack stats 可交互饼图。")]),e._v(" "),s("li",[s("a",{attrs:{href:"https://chrisbateman.github.io/webpack-visualizer/",target:"_blank",rel:"noopener noreferrer"}},[e._v("webpack-visualizer"),s("OutboundLink")],1),e._v(": 可视化并分析你的 bundle，检查哪些模块占用空间，哪些可能是重复使用的。")]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/webpack-contrib/webpack-bundle-analyzer",target:"_blank",rel:"noopener noreferrer"}},[e._v("webpack-bundle-analyzer"),s("OutboundLink")],1),e._v("：一个 plugin 和 CLI 工具，它将 bundle 内容展示为一个便捷的、交互式、可缩放的树状图形式。")]),e._v(" "),s("li",[s("a",{attrs:{href:"https://webpack.jakoblind.no/optimize",target:"_blank",rel:"noopener noreferrer"}},[e._v("webpack bundle optimize helper"),s("OutboundLink")],1),e._v("：这个工具会分析你的 bundle，并提供可操作的改进措施，以减少 bundle 的大小。")]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/bundle-stats/bundle-stats",target:"_blank",rel:"noopener noreferrer"}},[e._v("bundle-stats"),s("OutboundLink")],1),e._v("：生成一个 bundle 报告（bundle 大小、资源、模块），并比较不同构建之间的结果。")])]),e._v(" "),s("h3",{attrs:{id:"_2-缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-缓存"}},[e._v("#")]),e._v(" 2. 缓存")]),e._v(" "),s("p",[e._v("可以通过命中缓存，以降低网络流量，使网站加载速度更快，然而，如果我们在部署新版本时不更改资源的文件名，浏览器可能会认为它没有被更新，就会使用它的缓存版本。由于缓存的存在，当你需要获取新的代码时，就会显得很棘手。")]),e._v(" "),s("p",[e._v("此指南的重点在于通过必要的配置，以确保 webpack 编译生成的文件能够被客户端"),s("a",{attrs:{href:"https://webpack.docschina.org/guides/caching/",target:"_blank",rel:"noopener noreferrer"}},[e._v("缓存"),s("OutboundLink")],1),e._v("，而在文件内容变化后，能够请求到新的文件。")]),e._v(" "),s("h4",{attrs:{id:"输出文件的文件名-output-filename"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#输出文件的文件名-output-filename"}},[e._v("#")]),e._v(" 输出文件的文件名(output filename)")]),e._v(" "),s("p",[e._v("我们可以通过替换 "),s("code",[e._v("output.filename")]),e._v(" 中的 "),s("a",{attrs:{href:"https://webpack.docschina.org/configuration/output/#outputfilename",target:"_blank",rel:"noopener noreferrer"}},[e._v("substitutions"),s("OutboundLink")],1),e._v(" 设置，来定义输出文件的名称。webpack 提供了一种使用称为 "),s("strong",[e._v("substitution(可替换模板字符串)")]),e._v(" 的方式，通过带括号字符串来模板化文件名。其中，"),s("code",[e._v("[contenthash]")]),e._v(" substitution 将根据资源内容创建出唯一 hash。当资源内容发生变化时，"),s("code",[e._v("[contenthash]")]),e._v(" 也会发生变化。")]),e._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("output: {\n")])]),s("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[s("span",{pre:!0,attrs:{class:"token prefix deleted"}},[e._v("-")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("  filename: 'bundle.js',\n")])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("  filename: '[name].[contenthash].js',\n")])]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("  path: path.resolve(__dirname, 'dist'),\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("  clean: true,\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("},\n")])])])])]),s("h3",{attrs:{id:"_3-tree-shaking"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-tree-shaking"}},[e._v("#")]),e._v(" 3. Tree Shaking")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("术语")]),e._v(" "),s("p",[s("em",[s("a",{attrs:{href:"https://webpack.docschina.org/guides/tree-shaking/",target:"_blank",rel:"noopener noreferrer"}},[e._v("tree shaking"),s("OutboundLink")],1)]),e._v(" 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码(dead-code)。它依赖于 ES2015 模块语法的 "),s("a",{attrs:{href:"http://exploringjs.com/es6/ch_modules.html#static-module-structure",target:"_blank",rel:"noopener noreferrer"}},[e._v("静态结构"),s("OutboundLink")],1),e._v(" 特性，例如 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("import")]),s("OutboundLink")],1),e._v(" 和 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("export")]),s("OutboundLink")],1),e._v("。这个术语和概念实际上是由 ES2015 模块打包工具 "),s("a",{attrs:{href:"https://github.com/rollup/rollup",target:"_blank",rel:"noopener noreferrer"}},[e._v("rollup"),s("OutboundLink")],1),e._v(" 普及起来的。")])]),e._v(" "),s("p",[e._v("webpack 2 正式版本内置支持 ES2015 模块（也叫做 "),s("em",[e._v("harmony modules")]),e._v("）和未使用模块检测能力。新的 webpack 4 正式版本扩展了此检测能力，通过 "),s("code",[e._v("package.json")]),e._v(" 的 "),s("code",[e._v('"sideEffects"')]),e._v(' 属性作为标记，向 compiler 提供提示，表明项目中的哪些文件是 "pure(纯正 ES2015 模块)"，由此可以安全地删除文件中未使用的部分。')]),e._v(" "),s("h4",{attrs:{id:"解释-tree-shaking-和-sideeffects"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解释-tree-shaking-和-sideeffects"}},[e._v("#")]),e._v(" 解释 tree shaking 和 "),s("code",[e._v("sideEffects")])]),e._v(" "),s("p",[s("a",{attrs:{href:"https://webpack.docschina.org/configuration/optimization/#optimizationsideeffects",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("sideEffects")]),s("OutboundLink")],1),e._v(" 和 "),s("a",{attrs:{href:"https://webpack.docschina.org/configuration/optimization/#optimizationusedexports",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("usedExports")]),s("OutboundLink")],1),e._v("（更多被认为是 tree shaking）是两种不同的优化方式。")]),e._v(" "),s("p",[s("strong",[s("code",[e._v("sideEffects")]),e._v(" 更为有效")]),e._v(" 是因为它允许跳过整个模块/文件和整个文件子树。")]),e._v(" "),s("p",[s("code",[e._v("usedExports")]),e._v(" 依赖于 "),s("a",{attrs:{href:"https://github.com/terser-js/terser",target:"_blank",rel:"noopener noreferrer"}},[e._v("terser"),s("OutboundLink")],1),e._v(" 去检测语句中的副作用。它是一个 JavaScript 任务而且没有像 "),s("code",[e._v("sideEffects")]),e._v(" 一样简单直接。而且它不能跳转子树/依赖由于细则中说副作用需要被评估。尽管导出函数能运作如常，但 React 框架的高阶函数（HOC）在这种情况下是会出问题的。")]),e._v(" "),s("h4",{attrs:{id:"tree-sharking小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tree-sharking小结"}},[e._v("#")]),e._v(" tree sharking小结")]),e._v(" "),s("p",[e._v("因此，我们学到为了利用 "),s("em",[e._v("tree shaking")]),e._v(" 的优势， 你必须...")]),e._v(" "),s("ul",[s("li",[e._v("使用 ES2015 模块语法（即 "),s("code",[e._v("import")]),e._v(" 和 "),s("code",[e._v("export")]),e._v("）。")]),e._v(" "),s("li",[e._v("确保没有编译器将您的 ES2015 模块语法转换为 CommonJS 的（顺带一提，这是现在常用的 @babel/preset-env 的默认行为，详细信息请参阅"),s("a",{attrs:{href:"https://babeljs.io/docs/en/babel-preset-env#modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("文档"),s("OutboundLink")],1),e._v("）。")]),e._v(" "),s("li",[e._v("在项目的 "),s("code",[e._v("package.json")]),e._v(" 文件中，添加 "),s("code",[e._v('"sideEffects"')]),e._v(" 属性。")]),e._v(" "),s("li",[e._v("使用 "),s("code",[e._v("mode")]),e._v(" 为 "),s("code",[e._v('"production"')]),e._v(" 的配置项以启用"),s("a",{attrs:{href:"https://webpack.docschina.org/concepts/mode/#usage",target:"_blank",rel:"noopener noreferrer"}},[e._v("更多优化项"),s("OutboundLink")],1),e._v("，包括压缩代码与 tree shaking。")])]),e._v(" "),s("p",[e._v("你可以将应用程序想象成一棵树。绿色表示实际用到的 source code(源码) 和 library(库)，是树上活的树叶。灰色表示未引用代码，是秋天树上枯萎的树叶。为了除去死去的树叶，你必须摇动这棵树，使它们落下。")]),e._v(" "),s("p",[e._v("如果你对优化输出很感兴趣，请进入到下个指南，来了解 "),s("a",{attrs:{href:"https://webpack.docschina.org/guides/production",target:"_blank",rel:"noopener noreferrer"}},[e._v("生产环境"),s("OutboundLink")],1),e._v(" 构建的详细细节。")]),e._v(" "),s("h3",{attrs:{id:"_4-源码映射-source-mapping"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-源码映射-source-mapping"}},[e._v("#")]),e._v(" 4.源码映射(Source Mapping)")]),e._v(" "),s("p",[e._v("我们鼓励你在生产环境中启用 source map，因为它们对 debug(调试源码) 和运行 benchmark tests(基准测试) 很有帮助。虽然有着如此强大的功能，然而还是应该针对生产环境用途，选择一个可以快速构建的推荐配置（更多选项请查看 "),s("a",{attrs:{href:"https://webpack.docschina.org/configuration/devtool",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("devtool")]),s("OutboundLink")],1),e._v("）。对于本指南，我们将在 "),s("em",[e._v("生产环境")]),e._v(" 中使用 "),s("code",[e._v("source-map")]),e._v(" 选项，而不是我们在 "),s("em",[e._v("开发环境")]),e._v(" 中用到的 "),s("code",[e._v("inline-source-map")]),e._v("：")]),e._v(" "),s("p",[s("strong",[e._v("webpack.prod.js")])]),e._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" const { merge } = require('webpack-merge');\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" const common = require('./webpack.common.js');\n")])]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" module.exports = merge(common, {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   mode: 'production',\n")])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v("   devtool: 'source-map',\n")])]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v(" });\n")])])])])]),s("h3",{attrs:{id:"_5-压缩-css"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-压缩-css"}},[e._v("#")]),e._v(" 5.压缩 CSS")]),e._v(" "),s("p",[e._v("将生产环境下的 CSS 进行压缩会非常重要，请查看 "),s("a",{attrs:{href:"https://webpack.docschina.org/plugins/mini-css-extract-plugin/#minimizing-for-production",target:"_blank",rel:"noopener noreferrer"}},[e._v("在生产环境下压缩"),s("OutboundLink")],1),e._v(" 章节。")]),e._v(" "),s("p",[e._v("为了压缩输出文件，请使用类似于 "),s("a",{attrs:{href:"https://webpack.docschina.org/plugins/css-minimizer-webpack-plugin/",target:"_blank",rel:"noopener noreferrer"}},[e._v("css-minimizer-webpack-plugin"),s("OutboundLink")],1),e._v(" 这样的插件")]),e._v(" "),s("p",[s("strong",[e._v("webpack.prod.js")])]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" MiniCssExtractPlugin "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'mini-css-extract-plugin'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" CssMinimizerPlugin "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'css-minimizer-webpack-plugin'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  plugins"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MiniCssExtractPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      filename"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'[name].css'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      chunkFilename"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'[id].css'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  module"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    rules"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        test"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[e._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[e._v("\\.css$")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[e._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        use"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("MiniCssExtractPlugin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("loader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'css-loader'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  optimization"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    minimizer"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// For webpack@5 you can use the `...` syntax to extend existing minimizers (i.e. `terser-webpack-plugin`), uncomment the next line")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// `...`,")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("CssMinimizerPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),s("p",[e._v("这将只在生产模式下启用 CSS 压缩优化。如果你需要在开发模式下使用，请设置 "),s("code",[e._v("optimization.minimize")]),e._v(" 选项为 true。")]),e._v(" "),s("h3",{attrs:{id:"_6-cdn加速"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-cdn加速"}},[e._v("#")]),e._v(" 6. CDN加速")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("方式")]),e._v(" "),s("p",[e._v("将"),s("strong",[e._v("不怎么需要更新")]),e._v("的"),s("strong",[e._v("第三方库脱离webpack打包")]),e._v("，不被打入bundle中，从而减少打包时间，但又不影响运用第三方库的方式，例如import方式等")]),e._v(" "),s("ul",[s("li",[e._v("方式一：使用 "),s("code",[e._v("html-webpack-externals-plugin")])]),e._v(" "),s("li",[e._v("方式二：直接配置 "),s("code",[e._v("externals")])])])]),e._v(" "),s("h4",{attrs:{id:"html-webpack-externals-plugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#html-webpack-externals-plugin"}},[e._v("#")]),e._v(" html-webpack-externals-plugin")]),e._v(" "),s("p",[e._v("通常在 "),s("code",[e._v("webpack.base.conf.js")]),e._v(" 中进行配置，让其不打包到 "),s("code",[e._v("vendor.js")]),e._v(" 中，配置如下：（以vue框架为例）")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" HtmlWebpackExternalsPlugin "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'html-webpack-externals-plugin'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 其它省略...")]),e._v("\n    plugins"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("HtmlWebpackExternalsPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n          externals"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n            module"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'vue'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            entry"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'https://lib.baomitu.com/vue/2.6.12/vue.min.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            global"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Vue'")]),e._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 其它省略...")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("p",[e._v("最后看到在 "),s("code",[e._v("index.html")]),e._v(" 中动态添加了如下代码：")]),e._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("script")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("text/javascript"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("https://lib.baomitu.com/vue/2.6.12/vue.min.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("</")]),e._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n")])])]),s("h4",{attrs:{id:"externals配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#externals配置"}},[e._v("#")]),e._v(" externals配置")]),e._v(" "),s("p",[e._v("首先在 "),s("code",[e._v("index.html")]),e._v(" 中script标签引入JS，如下代码：")]),e._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("script")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("text/javascript"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),e._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("https://lib.baomitu.com/vue/2.6.12/vue.min.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("</")]),e._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n")])])]),s("p",[e._v("在 "),s("code",[e._v("webpack.base.conf.js")]),e._v(" 的配置如下：")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[e._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 其它省略...")]),e._v("\n    externals"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        vue"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Vue'")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 其它省略...")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),s("p",[s("strong",[e._v("development(开发环境)")]),e._v(" 和 "),s("strong",[e._v("production(生产环境)")]),e._v(" 这两个环境下的构建目标存在着巨大差异。")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("开发环境")]),e._v(" "),s("p",[e._v("在"),s("strong",[e._v("开发环境")]),e._v("中，我们需要：强大的 source map 和一个有着 live reloading(实时重新加载) 或 hot module replacement(热模块替换) 能力的 localhost server。")])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("生产环境")]),e._v(" "),s("p",[e._v("而"),s("strong",[e._v("生产环境")]),e._v("目标则转移至其他方面，关注点在于压缩 bundle、更轻量的 source map、资源优化等，通过这些优化方式改善加载时间。由于要遵循逻辑分离，我们通常建议为每个环境编写"),s("strong",[e._v("彼此独立的 webpack 配置")]),e._v("。")])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("webpack-merge")]),e._v(" "),s("p",[e._v("虽然，以上我们将 "),s("em",[e._v("生产环境")]),e._v(" 和 "),s("em",[e._v("开发环境")]),e._v(' 做了细微区分，但是，请注意，我们还是会遵循不重复原则(Don\'t repeat yourself - DRY)，保留一个 "common(通用)" 配置。为了将这些配置合并在一起，我们将使用一个名为 '),s("a",{attrs:{href:"https://github.com/survivejs/webpack-merge",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("webpack-merge")]),s("OutboundLink")],1),e._v(' 的工具。此工具会引用 "common" 配置，因此我们不必再在环境特定(environment-specific)的配置中编写重复代码。')])]),e._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[e._v("{\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('   "name": "development",\n')]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('   "version": "1.0.0",\n')]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('   "description": "",\n')]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('   "main": "src/index.js",\n')]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('   "scripts": {\n')])]),s("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[s("span",{pre:!0,attrs:{class:"token prefix deleted"}},[e._v("-")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('    "start": "webpack serve --open",\n')])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('    "start": "webpack serve --open --config webpack.dev.js",\n')])]),s("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[s("span",{pre:!0,attrs:{class:"token prefix deleted"}},[e._v("-")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('    "build": "webpack"\n')])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[e._v('    "build": "webpack --config webpack.prod.js"\n')])]),e._v("},\n")])])]),s("h2",{attrs:{id:"参考文献"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[e._v("#")]),e._v(" 参考文献")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://webpack.docschina.org/guides/build-performance/",target:"_blank",rel:"noopener noreferrer"}},[e._v("webpack文档 - 构建性能"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://webpack.docschina.org/guides/production/",target:"_blank",rel:"noopener noreferrer"}},[e._v("webpack文档 - 生产环境"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://webpack.docschina.org/configuration/optimization/",target:"_blank",rel:"noopener noreferrer"}},[e._v("webpack文档 - 优化(Optimization)"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);