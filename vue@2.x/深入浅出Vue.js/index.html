<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä¸€ã€ç®€ä»‹ | é›¶åŸºç¡€å­¦å‰ç«¯</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="learn fed">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.2d13298d.css" as="style"><link rel="preload" href="/assets/js/app.0a15208b.js" as="script"><link rel="preload" href="/assets/js/3.1a9699b9.js" as="script"><link rel="preload" href="/assets/js/9.dc9e2812.js" as="script"><link rel="prefetch" href="/assets/js/10.93902b8e.js"><link rel="prefetch" href="/assets/js/100.b1d7df1d.js"><link rel="prefetch" href="/assets/js/101.774f3587.js"><link rel="prefetch" href="/assets/js/102.ab1429e6.js"><link rel="prefetch" href="/assets/js/103.1380842b.js"><link rel="prefetch" href="/assets/js/104.2c445a62.js"><link rel="prefetch" href="/assets/js/105.55d36bdb.js"><link rel="prefetch" href="/assets/js/106.90146179.js"><link rel="prefetch" href="/assets/js/107.68a270bf.js"><link rel="prefetch" href="/assets/js/108.483767fe.js"><link rel="prefetch" href="/assets/js/109.cc916dce.js"><link rel="prefetch" href="/assets/js/11.e36136f7.js"><link rel="prefetch" href="/assets/js/110.7f1577b7.js"><link rel="prefetch" href="/assets/js/111.98147c99.js"><link rel="prefetch" href="/assets/js/112.ec1ebc18.js"><link rel="prefetch" href="/assets/js/113.121dd0c1.js"><link rel="prefetch" href="/assets/js/114.47c72628.js"><link rel="prefetch" href="/assets/js/115.d3bd3b3f.js"><link rel="prefetch" href="/assets/js/116.59911f4d.js"><link rel="prefetch" href="/assets/js/117.3615072e.js"><link rel="prefetch" href="/assets/js/118.81b33236.js"><link rel="prefetch" href="/assets/js/119.14c0bcdc.js"><link rel="prefetch" href="/assets/js/12.acf90667.js"><link rel="prefetch" href="/assets/js/120.e9ce28c2.js"><link rel="prefetch" href="/assets/js/121.faa569ec.js"><link rel="prefetch" href="/assets/js/122.56e1baf2.js"><link rel="prefetch" href="/assets/js/123.d8fcf331.js"><link rel="prefetch" href="/assets/js/124.9af97a21.js"><link rel="prefetch" href="/assets/js/125.2ec844e6.js"><link rel="prefetch" href="/assets/js/126.f5a27e20.js"><link rel="prefetch" href="/assets/js/127.1523ad1f.js"><link rel="prefetch" href="/assets/js/128.959e0cb2.js"><link rel="prefetch" href="/assets/js/129.c3afa873.js"><link rel="prefetch" href="/assets/js/13.a0cc0a36.js"><link rel="prefetch" href="/assets/js/130.f94d0650.js"><link rel="prefetch" href="/assets/js/131.c4546c33.js"><link rel="prefetch" href="/assets/js/132.a42ee650.js"><link rel="prefetch" href="/assets/js/133.43a9df61.js"><link rel="prefetch" href="/assets/js/134.eb00c648.js"><link rel="prefetch" href="/assets/js/135.def97609.js"><link rel="prefetch" href="/assets/js/136.bcf734d3.js"><link rel="prefetch" href="/assets/js/137.2022d32a.js"><link rel="prefetch" href="/assets/js/138.1005403a.js"><link rel="prefetch" href="/assets/js/139.4dcc9582.js"><link rel="prefetch" href="/assets/js/14.70f353f5.js"><link rel="prefetch" href="/assets/js/140.d3c8e60c.js"><link rel="prefetch" href="/assets/js/141.838dfc26.js"><link rel="prefetch" href="/assets/js/142.6f0978a8.js"><link rel="prefetch" href="/assets/js/143.a0523db7.js"><link rel="prefetch" href="/assets/js/144.51e4db65.js"><link rel="prefetch" href="/assets/js/145.248c914d.js"><link rel="prefetch" href="/assets/js/146.27d059ef.js"><link rel="prefetch" href="/assets/js/147.4fd147a1.js"><link rel="prefetch" href="/assets/js/148.392cd869.js"><link rel="prefetch" href="/assets/js/149.f97328a5.js"><link rel="prefetch" href="/assets/js/15.6807b5b5.js"><link rel="prefetch" href="/assets/js/150.c6bd7746.js"><link rel="prefetch" href="/assets/js/151.b7035f3a.js"><link rel="prefetch" href="/assets/js/152.33eee21f.js"><link rel="prefetch" href="/assets/js/153.d29c3cc3.js"><link rel="prefetch" href="/assets/js/154.38a3da58.js"><link rel="prefetch" href="/assets/js/155.4023b45b.js"><link rel="prefetch" href="/assets/js/156.38dccf7b.js"><link rel="prefetch" href="/assets/js/157.38199b9d.js"><link rel="prefetch" href="/assets/js/158.436ed442.js"><link rel="prefetch" href="/assets/js/159.fe412ff8.js"><link rel="prefetch" href="/assets/js/16.0323100d.js"><link rel="prefetch" href="/assets/js/160.eb4468b7.js"><link rel="prefetch" href="/assets/js/161.8758e21f.js"><link rel="prefetch" href="/assets/js/162.de20ddd0.js"><link rel="prefetch" href="/assets/js/163.6c231dcc.js"><link rel="prefetch" href="/assets/js/164.eeeb27a3.js"><link rel="prefetch" href="/assets/js/165.d4626122.js"><link rel="prefetch" href="/assets/js/166.c37e05b4.js"><link rel="prefetch" href="/assets/js/167.af8d5125.js"><link rel="prefetch" href="/assets/js/168.0123bca6.js"><link rel="prefetch" href="/assets/js/169.dcb27fe6.js"><link rel="prefetch" href="/assets/js/17.c1576e94.js"><link rel="prefetch" href="/assets/js/170.93b81585.js"><link rel="prefetch" href="/assets/js/171.3217839d.js"><link rel="prefetch" href="/assets/js/172.6e960fd3.js"><link rel="prefetch" href="/assets/js/173.6a769945.js"><link rel="prefetch" href="/assets/js/18.5a2271a7.js"><link rel="prefetch" href="/assets/js/19.cf5a5d2e.js"><link rel="prefetch" href="/assets/js/2.c3e53dd5.js"><link rel="prefetch" href="/assets/js/20.84597afa.js"><link rel="prefetch" href="/assets/js/21.d3226c57.js"><link rel="prefetch" href="/assets/js/22.b1eafa65.js"><link rel="prefetch" href="/assets/js/23.b472d6d0.js"><link rel="prefetch" href="/assets/js/24.28103653.js"><link rel="prefetch" href="/assets/js/25.9a234cd5.js"><link rel="prefetch" href="/assets/js/26.87589ca9.js"><link rel="prefetch" href="/assets/js/27.0967113b.js"><link rel="prefetch" href="/assets/js/28.31f3f702.js"><link rel="prefetch" href="/assets/js/29.74529a51.js"><link rel="prefetch" href="/assets/js/30.e7349b17.js"><link rel="prefetch" href="/assets/js/31.733e35c5.js"><link rel="prefetch" href="/assets/js/32.b36e5b86.js"><link rel="prefetch" href="/assets/js/33.08d43715.js"><link rel="prefetch" href="/assets/js/34.c1fb5185.js"><link rel="prefetch" href="/assets/js/35.33bf39f9.js"><link rel="prefetch" href="/assets/js/36.e419a1c0.js"><link rel="prefetch" href="/assets/js/37.003c789c.js"><link rel="prefetch" href="/assets/js/38.fcc3b1d1.js"><link rel="prefetch" href="/assets/js/39.460d9813.js"><link rel="prefetch" href="/assets/js/4.073dcbaf.js"><link rel="prefetch" href="/assets/js/40.6272c91e.js"><link rel="prefetch" href="/assets/js/41.7548eb2a.js"><link rel="prefetch" href="/assets/js/42.d291a60e.js"><link rel="prefetch" href="/assets/js/43.2fc49262.js"><link rel="prefetch" href="/assets/js/44.d0f0cc91.js"><link rel="prefetch" href="/assets/js/45.0e639fa5.js"><link rel="prefetch" href="/assets/js/46.bcffc723.js"><link rel="prefetch" href="/assets/js/47.8b76bd42.js"><link rel="prefetch" href="/assets/js/48.a086fb36.js"><link rel="prefetch" href="/assets/js/49.2e5993ec.js"><link rel="prefetch" href="/assets/js/5.77ab1bee.js"><link rel="prefetch" href="/assets/js/50.f5380226.js"><link rel="prefetch" href="/assets/js/51.04a9006d.js"><link rel="prefetch" href="/assets/js/52.93ae97cb.js"><link rel="prefetch" href="/assets/js/53.288ff34a.js"><link rel="prefetch" href="/assets/js/54.afc1157f.js"><link rel="prefetch" href="/assets/js/55.8125b62d.js"><link rel="prefetch" href="/assets/js/56.4be2ebef.js"><link rel="prefetch" href="/assets/js/57.1048cf19.js"><link rel="prefetch" href="/assets/js/58.edb8d625.js"><link rel="prefetch" href="/assets/js/59.9b588b46.js"><link rel="prefetch" href="/assets/js/6.17809d55.js"><link rel="prefetch" href="/assets/js/60.bd10232f.js"><link rel="prefetch" href="/assets/js/61.1ee43883.js"><link rel="prefetch" href="/assets/js/62.d6502e47.js"><link rel="prefetch" href="/assets/js/63.f52d2d29.js"><link rel="prefetch" href="/assets/js/64.ce045a28.js"><link rel="prefetch" href="/assets/js/65.dbbe1cec.js"><link rel="prefetch" href="/assets/js/66.bfb6c12d.js"><link rel="prefetch" href="/assets/js/67.17dca53b.js"><link rel="prefetch" href="/assets/js/68.8a221ebd.js"><link rel="prefetch" href="/assets/js/69.beac962a.js"><link rel="prefetch" href="/assets/js/7.8cfd716a.js"><link rel="prefetch" href="/assets/js/70.8b48eed9.js"><link rel="prefetch" href="/assets/js/71.d5f6f35d.js"><link rel="prefetch" href="/assets/js/72.14c92216.js"><link rel="prefetch" href="/assets/js/73.c4a69c11.js"><link rel="prefetch" href="/assets/js/74.ed6e2fe0.js"><link rel="prefetch" href="/assets/js/75.ee30261f.js"><link rel="prefetch" href="/assets/js/76.e38507e4.js"><link rel="prefetch" href="/assets/js/77.d1f14b7c.js"><link rel="prefetch" href="/assets/js/78.85e21359.js"><link rel="prefetch" href="/assets/js/79.45ecf73b.js"><link rel="prefetch" href="/assets/js/8.2d436547.js"><link rel="prefetch" href="/assets/js/80.1dfc7a9c.js"><link rel="prefetch" href="/assets/js/81.cc70aa95.js"><link rel="prefetch" href="/assets/js/82.422940b9.js"><link rel="prefetch" href="/assets/js/83.e5fd22f1.js"><link rel="prefetch" href="/assets/js/84.c90f4b19.js"><link rel="prefetch" href="/assets/js/85.261d903a.js"><link rel="prefetch" href="/assets/js/86.e1247b3b.js"><link rel="prefetch" href="/assets/js/87.b3794b25.js"><link rel="prefetch" href="/assets/js/88.eb46a6b4.js"><link rel="prefetch" href="/assets/js/89.b9b2a5f1.js"><link rel="prefetch" href="/assets/js/90.24214291.js"><link rel="prefetch" href="/assets/js/91.2df53d20.js"><link rel="prefetch" href="/assets/js/92.8ce36d00.js"><link rel="prefetch" href="/assets/js/93.074b4da6.js"><link rel="prefetch" href="/assets/js/94.a461198a.js"><link rel="prefetch" href="/assets/js/95.94ae2ad4.js"><link rel="prefetch" href="/assets/js/96.8b64e9d0.js"><link rel="prefetch" href="/assets/js/97.a78e12ca.js"><link rel="prefetch" href="/assets/js/98.1e663af0.js"><link rel="prefetch" href="/assets/js/99.842d550f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2d13298d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">é›¶åŸºç¡€å­¦å‰ç«¯</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ“å‰ç«¯å¼€å‘" class="dropdown-title"><span class="title">ğŸ“å‰ç«¯å¼€å‘</span> <span class="arrow down"></span></button> <button type="button" aria-label="ğŸ“å‰ç«¯å¼€å‘" class="mobile-dropdown-title"><span class="title">ğŸ“å‰ç«¯å¼€å‘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ä»å…¥é—¨åˆ°æ”¾å¼ƒ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/guide/" class="nav-link">
  æŒ‡å—
</a></li><li class="dropdown-subitem"><a href="/HTML/" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/JS/" class="nav-link">
  JavaScript
</a></li></ul></li><li class="dropdown-item"><h4>
          å·¥å…·ç±»
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Babel/" class="nav-link">
  Babel
</a></li><li class="dropdown-subitem"><a href="/webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-subitem"><a href="/TypeScript/" class="nav-link">
  TypeScript
</a></li></ul></li><li class="dropdown-item"><h4>
          å…¶å®ƒ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/browser/" class="nav-link">
  æµè§ˆå™¨
</a></li><li class="dropdown-subitem"><a href="/git/" class="nav-link">
  Gitå’ŒGitHub
</a></li><li class="dropdown-subitem"><a href="/MarkDown/" class="nav-link">
  MarkDownæ–‡æ¡£
</a></li><li class="dropdown-subitem"><a href="/GIS/" class="nav-link">
  webgis
</a></li><li class="dropdown-subitem"><a href="/Flutter/" class="nav-link">
  Flutter
</a></li><li class="dropdown-subitem"><a href="/test/" class="nav-link">
  æµ‹è¯•
</a></li><li class="dropdown-subitem"><a href="/Axure/" class="nav-link">
  Axure
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ„å¤§å‰ç«¯" class="dropdown-title"><span class="title">ğŸ„å¤§å‰ç«¯</span> <span class="arrow down"></span></button> <button type="button" aria-label="ğŸ„å¤§å‰ç«¯" class="mobile-dropdown-title"><span class="title">ğŸ„å¤§å‰ç«¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          VueJS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue@0.11/" class="nav-link">
  vue_0.11
</a></li><li class="dropdown-subitem"><a href="/vue@2.x/" class="nav-link router-link-active">
  vue_2.x
</a></li><li class="dropdown-subitem"><a href="/Vue/" class="nav-link">
  vue
</a></li></ul></li><li class="dropdown-item"><h4>
          Vue CLI
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue-cli/" class="nav-link">
  vue_cli
</a></li></ul></li><li class="dropdown-item"><h4>
          React
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/React/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/DvaJS/" class="nav-link">
  DvaJS
</a></li><li class="dropdown-subitem"><a href="/UmiJS/" class="nav-link">
  UmiJS
</a></li></ul></li><li class="dropdown-item"><h4>
          NodeJS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/NodeJS/" class="nav-link">
  NodeJS
</a></li></ul></li><li class="dropdown-item"><h4>
          æ¶æ„å¸ˆ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fearchitect/" class="nav-link">
  æ¶æ„èƒ½åŠ›
</a></li><li class="dropdown-subitem"><a href="/design-patterns/" class="nav-link">
  è®¾è®¡æ¨¡å¼
</a></li><li class="dropdown-subitem"><a href="/HTTP/" class="nav-link">
  HTTPåè®®
</a></li><li class="dropdown-subitem"><a href="/algorithm/" class="nav-link">
  ç®—æ³•
</a></li><li class="dropdown-subitem"><a href="/performance/" class="nav-link">
  æ€§èƒ½ä¼˜åŒ–
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ“åç«¯å¼€å‘" class="dropdown-title"><span class="title">ğŸ“åç«¯å¼€å‘</span> <span class="arrow down"></span></button> <button type="button" aria-label="ğŸ“åç«¯å¼€å‘" class="mobile-dropdown-title"><span class="title">ğŸ“åç«¯å¼€å‘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          LNMP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/LNMP/" class="nav-link">
  LNMP
</a></li><li class="dropdown-subitem"><a href="/SQL/" class="nav-link">
  SQL
</a></li></ul></li><li class="dropdown-item"><h4>
          æ“ä½œç³»ç»Ÿ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/MacOS/" class="nav-link">
  MacOS
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ¯ç»ç†äºº" class="dropdown-title"><span class="title">ğŸ¯ç»ç†äºº</span> <span class="arrow down"></span></button> <button type="button" aria-label="ğŸ¯ç»ç†äºº" class="mobile-dropdown-title"><span class="title">ğŸ¯ç»ç†äºº</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          èŒä¸šç»ç†äºº
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/manage/" class="nav-link">
  èŠèŠç®¡ç†
</a></li><li class="dropdown-subitem"><a href="/manage/career/" class="nav-link">
  èŒä¸šè§„åˆ’
</a></li><li class="dropdown-subitem"><a href="/manage/interview/" class="nav-link">
  é¢è¯•æŒ‡å—
</a></li><li class="dropdown-subitem"><a href="/manage/ability/" class="nav-link">
  èƒ½åŠ›æ¡†æ¶
</a></li></ul></li><li class="dropdown-item"><h4>
          HRå…­å¤§æ¨¡å—
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OKR/" class="nav-link">
  OKR
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ–‡æ¡£æŒ‡å—" class="dropdown-title"><span class="title">æ–‡æ¡£æŒ‡å—</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ–‡æ¡£æŒ‡å—" class="mobile-dropdown-title"><span class="title">æ–‡æ¡£æŒ‡å—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computing/" class="nav-link">
  è®¡ç®—æœºä¸ç½‘ç»œ
</a></li><li class="dropdown-item"><!----> <a href="https://www.quanzhanketang.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  w3schoolsåŸç‰ˆé•œåƒ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.w3school.com.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  w3schoolsä¸­æ–‡ç¿»è¯‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://developer.mozilla.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MDN Web Docs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ“å‰ç«¯å¼€å‘" class="dropdown-title"><span class="title">ğŸ“å‰ç«¯å¼€å‘</span> <span class="arrow down"></span></button> <button type="button" aria-label="ğŸ“å‰ç«¯å¼€å‘" class="mobile-dropdown-title"><span class="title">ğŸ“å‰ç«¯å¼€å‘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ä»å…¥é—¨åˆ°æ”¾å¼ƒ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/guide/" class="nav-link">
  æŒ‡å—
</a></li><li class="dropdown-subitem"><a href="/HTML/" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/JS/" class="nav-link">
  JavaScript
</a></li></ul></li><li class="dropdown-item"><h4>
          å·¥å…·ç±»
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Babel/" class="nav-link">
  Babel
</a></li><li class="dropdown-subitem"><a href="/webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-subitem"><a href="/TypeScript/" class="nav-link">
  TypeScript
</a></li></ul></li><li class="dropdown-item"><h4>
          å…¶å®ƒ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/browser/" class="nav-link">
  æµè§ˆå™¨
</a></li><li class="dropdown-subitem"><a href="/git/" class="nav-link">
  Gitå’ŒGitHub
</a></li><li class="dropdown-subitem"><a href="/MarkDown/" class="nav-link">
  MarkDownæ–‡æ¡£
</a></li><li class="dropdown-subitem"><a href="/GIS/" class="nav-link">
  webgis
</a></li><li class="dropdown-subitem"><a href="/Flutter/" class="nav-link">
  Flutter
</a></li><li class="dropdown-subitem"><a href="/test/" class="nav-link">
  æµ‹è¯•
</a></li><li class="dropdown-subitem"><a href="/Axure/" class="nav-link">
  Axure
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ„å¤§å‰ç«¯" class="dropdown-title"><span class="title">ğŸ„å¤§å‰ç«¯</span> <span class="arrow down"></span></button> <button type="button" aria-label="ğŸ„å¤§å‰ç«¯" class="mobile-dropdown-title"><span class="title">ğŸ„å¤§å‰ç«¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          VueJS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue@0.11/" class="nav-link">
  vue_0.11
</a></li><li class="dropdown-subitem"><a href="/vue@2.x/" class="nav-link router-link-active">
  vue_2.x
</a></li><li class="dropdown-subitem"><a href="/Vue/" class="nav-link">
  vue
</a></li></ul></li><li class="dropdown-item"><h4>
          Vue CLI
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue-cli/" class="nav-link">
  vue_cli
</a></li></ul></li><li class="dropdown-item"><h4>
          React
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/React/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/DvaJS/" class="nav-link">
  DvaJS
</a></li><li class="dropdown-subitem"><a href="/UmiJS/" class="nav-link">
  UmiJS
</a></li></ul></li><li class="dropdown-item"><h4>
          NodeJS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/NodeJS/" class="nav-link">
  NodeJS
</a></li></ul></li><li class="dropdown-item"><h4>
          æ¶æ„å¸ˆ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fearchitect/" class="nav-link">
  æ¶æ„èƒ½åŠ›
</a></li><li class="dropdown-subitem"><a href="/design-patterns/" class="nav-link">
  è®¾è®¡æ¨¡å¼
</a></li><li class="dropdown-subitem"><a href="/HTTP/" class="nav-link">
  HTTPåè®®
</a></li><li class="dropdown-subitem"><a href="/algorithm/" class="nav-link">
  ç®—æ³•
</a></li><li class="dropdown-subitem"><a href="/performance/" class="nav-link">
  æ€§èƒ½ä¼˜åŒ–
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ“åç«¯å¼€å‘" class="dropdown-title"><span class="title">ğŸ“åç«¯å¼€å‘</span> <span class="arrow down"></span></button> <button type="button" aria-label="ğŸ“åç«¯å¼€å‘" class="mobile-dropdown-title"><span class="title">ğŸ“åç«¯å¼€å‘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          LNMP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/LNMP/" class="nav-link">
  LNMP
</a></li><li class="dropdown-subitem"><a href="/SQL/" class="nav-link">
  SQL
</a></li></ul></li><li class="dropdown-item"><h4>
          æ“ä½œç³»ç»Ÿ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/MacOS/" class="nav-link">
  MacOS
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ¯ç»ç†äºº" class="dropdown-title"><span class="title">ğŸ¯ç»ç†äºº</span> <span class="arrow down"></span></button> <button type="button" aria-label="ğŸ¯ç»ç†äºº" class="mobile-dropdown-title"><span class="title">ğŸ¯ç»ç†äºº</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          èŒä¸šç»ç†äºº
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/manage/" class="nav-link">
  èŠèŠç®¡ç†
</a></li><li class="dropdown-subitem"><a href="/manage/career/" class="nav-link">
  èŒä¸šè§„åˆ’
</a></li><li class="dropdown-subitem"><a href="/manage/interview/" class="nav-link">
  é¢è¯•æŒ‡å—
</a></li><li class="dropdown-subitem"><a href="/manage/ability/" class="nav-link">
  èƒ½åŠ›æ¡†æ¶
</a></li></ul></li><li class="dropdown-item"><h4>
          HRå…­å¤§æ¨¡å—
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/OKR/" class="nav-link">
  OKR
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ–‡æ¡£æŒ‡å—" class="dropdown-title"><span class="title">æ–‡æ¡£æŒ‡å—</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ–‡æ¡£æŒ‡å—" class="mobile-dropdown-title"><span class="title">æ–‡æ¡£æŒ‡å—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computing/" class="nav-link">
  è®¡ç®—æœºä¸ç½‘ç»œ
</a></li><li class="dropdown-item"><!----> <a href="https://www.quanzhanketang.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  w3schoolsåŸç‰ˆé•œåƒ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.w3school.com.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  w3schoolsä¸­æ–‡ç¿»è¯‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://developer.mozilla.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MDN Web Docs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="header-anchor">#</a> ä¸€ã€ç®€ä»‹</h2> <h3 id="æ¡†æ¶åˆ†å±‚"><a href="#æ¡†æ¶åˆ†å±‚" class="header-anchor">#</a> æ¡†æ¶åˆ†å±‚</h3> <blockquote><p>The Progressive JavaScript Framework</p></blockquote> <p>The Progressive Frameworkï¼Œç¿»è¯‘æˆä¸­æ–‡æ˜¯ï¼šæ¸è¿›å¼æ¡†æ¶ï¼Œå³æŠŠæ¡†æ¶åˆ†å±‚ã€‚</p> <p><img src="/assets/img/progressive_framework.630e2b4b.png" alt="æ¡†æ¶åˆ†å±‚"></p> <h2 id="äºŒã€objectçš„å˜åŒ–ä¾¦æµ‹"><a href="#äºŒã€objectçš„å˜åŒ–ä¾¦æµ‹" class="header-anchor">#</a> äºŒã€Objectçš„å˜åŒ–ä¾¦æµ‹</h2> <h3 id="å¦‚ä½•è¿½è¸ªå˜åŒ–"><a href="#å¦‚ä½•è¿½è¸ªå˜åŒ–" class="header-anchor">#</a> å¦‚ä½•è¿½è¸ªå˜åŒ–</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> val
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">===</span> newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      val <span class="token operator">=</span> newVal
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ”¶é›†ä¾èµ–"><a href="#æ”¶é›†ä¾èµ–" class="header-anchor">#</a> æ”¶é›†ä¾èµ–</h3> <p>åœ¨ <strong>getter</strong> ä¸­æ”¶é›†ä¾èµ–ï¼Œåœ¨ <strong>setter</strong> ä¸­è§¦å‘ä¾èµ–ã€‚</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function defineReactive(data, key, val) {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> let dep = []
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   Object.defineProperty(data, key, {
</span><span class="token prefix unchanged"> </span><span class="token line">     enumerable: true,
</span><span class="token prefix unchanged"> </span><span class="token line">     configurable: true,
</span><span class="token prefix unchanged"> </span><span class="token line">     get: function() {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       dep.push(window.target)
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       return val
</span><span class="token prefix unchanged"> </span><span class="token line">     },
</span><span class="token prefix unchanged"> </span><span class="token line">     set: function(newVal) {
</span><span class="token prefix unchanged"> </span><span class="token line">       if(val === newVal) {
</span><span class="token prefix unchanged"> </span><span class="token line">         return
</span><span class="token prefix unchanged"> </span><span class="token line">       }
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       for(let i = 0; i &lt; dep.length; i++) {
</span><span class="token prefix inserted">+</span><span class="token line">         dep[i](newVal, val)
</span><span class="token prefix inserted">+</span><span class="token line">       }
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       val = newVal
</span><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   })
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></code></pre></div><p>è¿™é‡Œæˆ‘ä»¬æ–°å¢äº†æ•°æ® <code>dep</code>ï¼Œç”¨æ¥å­˜å‚¨è¢«æ”¶é›†çš„ä¾èµ–ã€‚ç„¶ååœ¨ <code>set</code> è¢«è§¦å‘æ—¶ï¼Œå¾ªç¯ <code>dep</code> ä»¥è§¦å‘æ”¶é›†åˆ°çš„ä¾èµ–ã€‚</p> <p>ä½†æ˜¯ï¼Œè¿™æ ·å†™æœ‰ç‚¹è€¦åˆï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¾èµ–æ”¶é›†çš„ä»£ç å°è£…æˆä¸€ä¸ª<code>Dep</code>ç±»ï¼Œå®ƒä¸“é—¨å¸®åŠ©æˆ‘ä»¬ç®¡ç†ä¾èµ–ã€‚å®ƒå¯ä»¥æ”¶é›†ä¾èµ–ã€åˆ é™¤ä¾èµ–æˆ–è€…å‘ä¾èµ–å‘é€é€šçŸ¥ç­‰ã€‚å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">addSub</span> <span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">removeSub</span> <span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">,</span> sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">depend</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> subs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> subs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      subs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ”¹é€ ä¸€ä¸‹ä¹‹å‰çš„ <code>defineReactive</code>ï¼š</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> function defineReactive(data, key, val) {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> let dep = new Dep()
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   Object.defineProperty(data, key, {
</span><span class="token prefix unchanged"> </span><span class="token line">     enumerable: true,
</span><span class="token prefix unchanged"> </span><span class="token line">     configurable: true,
</span><span class="token prefix unchanged"> </span><span class="token line">     get: function() {
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       dep.depend()
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       return val
</span><span class="token prefix unchanged"> </span><span class="token line">     },
</span><span class="token prefix unchanged"> </span><span class="token line">     set: function(newVal) {
</span><span class="token prefix unchanged"> </span><span class="token line">       if(val === newVal) {
</span><span class="token prefix unchanged"> </span><span class="token line">         return
</span><span class="token prefix unchanged"> </span><span class="token line">       }
</span><span class="token prefix unchanged"> </span><span class="token line">       val = newVal
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       dep.notify()
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   })
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></code></pre></div><p>è¿™æ ·ï¼Œä¾èµ–å°±ä¼šæ”¶é›†åˆ°Depä¸­ã€‚</p> <h3 id="ä¾èµ–æ˜¯è°"><a href="#ä¾èµ–æ˜¯è°" class="header-anchor">#</a> ä¾èµ–æ˜¯è°</h3> <p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ”¶é›†çš„ä¾èµ–æ˜¯ <code>window.target</code>ã€‚</p> <p>â€‹		æˆ‘ä»¬è¦é€šçŸ¥ç”¨åˆ°æ•°æ®çš„åœ°æ–¹ï¼Œè€Œä½¿ç”¨è¿™ä¸ªæ•°æ®çš„åœ°æ–¹æœ‰å¾ˆå¤šï¼Œè€Œä¸”ç±»å‹è¿˜ä¸ä¸€æ ·ï¼Œæ—¢æœ‰å¯èƒ½æ˜¯æ¨¡æ¿ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯watchï¼Œæ­¤æ—¶éœ€è¦æŠ½è±¡å‡ºä¸€ä¸ªèƒ½é›†ä¸­å¤„ç†è¿™äº›æƒ…å†µçš„ç±»ã€‚</p> <p>ç„¶åï¼Œæˆ‘ä»¬åœ¨ä¾èµ–æ”¶é›†é˜¶æ®µåªæ”¶é›†è¿™ä¸ªå°è£…å¥½çš„ç±»çš„å®ä¾‹è¿›æ¥ï¼Œé€šçŸ¥ä¹Ÿæ˜¯åªé€šçŸ¥å®ƒä¸€ä¸ªã€‚</p> <p>æ¥ç€ï¼Œå®ƒå†è´Ÿè´£é€šçŸ¥å…¶å®ƒåœ°æ–¹ã€‚</p> <p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦æŠ½è±¡çš„è¿™ä¸ªä¸œè¥¿ï¼Œå°±å«å®ƒ <code>Watcher</code>å§ã€‚</p> <h3 id="watcher"><a href="#watcher" class="header-anchor">#</a> Watcher</h3> <p><code>Watcher</code>æ˜¯ä¸€ä¸ªä¸­ä»‹è§’è‰²ï¼Œæ•°æ®å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥å®ƒï¼Œç„¶åå®ƒå†é€šçŸ¥å…¶å®ƒåœ°æ–¹ã€‚æ¥çœ‹ä¸€ä¸ªç»å…¸çš„ä½¿ç”¨æ–¹å¼ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'a.b.c'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>è¿™æ®µä»£ç è¡¨ç¤ºï¼Œå½“ <code>data.a.b.c</code> å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§¦å‘ç¬¬äºŒä¸ªå‚æ•°ä¸­çš„å‡½æ•°ã€‚</p> <p>æ€è€ƒä¸€ä¸‹ï¼Œæ€ä¹ˆå®ç°è¿™ä¸ªåŠŸèƒ½å‘¢ï¼Ÿ</p> <p>å¥½åƒï¼Œåªè¦æŠŠè¿™ä¸ª<code>watcher</code>å®ä¾‹æ·»åŠ åˆ° <code>data.a.b.c</code> å±æ€§çš„<code>Dep</code>ä¸­å°±è¡Œäº†ã€‚ç„¶åï¼Œå½“ <code>data.a.b.c</code> çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šçŸ¥ <code>Watcher</code>ã€‚æ¥ç€ï¼Œ<code>Watcher</code> å†æ‰§è¡Œå‚æ•°ä¸­çš„è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> expOrFn<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm
    <span class="token comment">// æ‰§è¡Œ this.getter() å°±å¯ä»¥è¯»å– data.a.b.cçš„å†…å®¹</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> <span class="token function">parsePath</span><span class="token punctuation">(</span>expOrFn<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">)</span>
    window<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">undefined</span>
    <span class="token keyword">return</span> value
  <span class="token punctuation">}</span>
  
  <span class="token function">update</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> oldValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™æ®µä»£ç ï¼Œå¯ä»¥æŠŠè‡ªå·±ä¸»åŠ¨æ·»åŠ åˆ° <code>data.a.b.c</code>çš„<code>Dep</code>ä¸­å»ã€‚</p> <p>ä¸Šé¢çš„ä»£ç ä¸­ <code>parsePath</code> æ˜¯æ€ä¹ˆè¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²çš„ <strong>keypath</strong> çš„å‘¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»£ç ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * è§£æç®€å•è·¯å¾„
 **/</span>
<span class="token keyword">const</span> bailRE <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[^\w.$]</span><span class="token regex-delimiter">/</span></span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">parsePath</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>bailRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å°†pathç”¨.åˆ†å‰²æˆæ•°ç»„</span>
  <span class="token keyword">const</span> segments <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¾ªç¯éå†æ•°ç»„ï¼Œä¸€å±‚ä¸€å±‚å»è¯»å–æ•°æ®ï¼›æœ€åæ‹¿åˆ°pathä¸­æƒ³åˆ°çš„æ•°æ®</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> segments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      obj <span class="token operator">=</span> obj<span class="token punctuation">[</span>segments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> obj
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="é€’å½’ä¾¦æµ‹æ‰€æœ‰key"><a href="#é€’å½’ä¾¦æµ‹æ‰€æœ‰key" class="header-anchor">#</a> é€’å½’ä¾¦æµ‹æ‰€æœ‰key</h3> <p>ä¸Šé¢ï¼Œæˆ‘ä»¬å·²ç»å®ç°å˜åŒ–ä¾¦æµ‹çš„åŠŸèƒ½äº†ï¼Œä½†åªèƒ½ä¾¦æµ‹æ•°æ®ä¸­çš„æŸä¸€ä¸ªå±æ€§ã€‚æˆ‘ä»¬å¸Œæœ›æŠŠæ•°æ®ä¸­çš„æ‰€æœ‰å±æ€§ï¼ˆåŒ…æ‹¬å­å±æ€§ï¼‰éƒ½ä¾¦æµ‹åˆ°ï¼Œæ‰€ä»¥è¦å°è£…ä¸€ä¸ª <code>Observer</code> ç±»ã€‚</p> <p>è¿™ä¸ªç±»çš„ä½œç”¨æ˜¯ï¼Œå°†ä¸€ä¸ªæ•°æ®å†…çš„æ‰€æœ‰å±æ€§ï¼ˆåŒ…æ‹¬å­å±æ€§ï¼‰éƒ½è½¬æ¢æˆ <code>gettser/setter</code> çš„å½¢å¼ï¼Œç„¶åå»è¿½è¸ªå®ƒä»¬çš„å˜åŒ–ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Observerç±»ä¼šé™„åŠ åˆ°æ¯ä¸€ä¸ªè¢«ä¾¦æµ‹çš„objectä¸Šã€‚
 * ä¸€æ—¦è¢«é™„åŠ ä¸Šï¼ŒObserverä¼šå°†objectçš„æ‰€æœ‰å±æ€§è½¬æ¢ä¸º getter/setter çš„å½¢å¼
 * æ¥æ”¶é›†å±æ€§çš„ä¾èµ–ï¼Œå¹¶ä¸”å½“å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥è¿™äº›ä¾èµ–
 **/</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">/**
   * walk ä¼šå°†æ¯ä¸€ä¸ªå±æ€§éƒ½è½¬æ¢æˆ getter/setter çš„å½¢å¼æ¥ä¾¦æµ‹å˜åŒ–
   * è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨æ•°æ®ç±»å‹ä¸º Object æ—¶è¢«è°ƒç”¨
   **/</span>
  <span class="token function">walk</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">defineReactive</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'obj'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">let</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> val
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">===</span> newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      
      val <span class="token operator">=</span> newVal
      dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="å…³äºobjectçš„é—®é¢˜"><a href="#å…³äºobjectçš„é—®é¢˜" class="header-anchor">#</a> å…³äºobjectçš„é—®é¢˜</h3> <p>å½“æˆ‘ä»¬åœ¨ objä¸Šæ–°å¢ä¸€ä¸ª nameå±æ€§ï¼ŒVue.jsæ— æ³•ä¾¦æµ‹åˆ°è¿™ä¸ªå˜åŒ–ï¼Œæ‰€ä»¥ä¸ä¼šå‘ä¾èµ–å‘é€é€šçŸ¥ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    obj<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'leon'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å†æ¯”å¦‚ï¼Œä»objä¸­åˆ é™¤ä¸€ä¸ªå±æ€§ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    obj<span class="token operator">:</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'leon'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>obj<span class="token punctuation">.</span>name
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>â€‹		Vue.jsé€šè¿‡<code>Object.defineProperty</code>æ¥å°†å¯¹è±¡çš„ <code>key</code> è½¬æ¢æˆ <code>getter/setter</code> çš„å½¢å¼æ¥è¿½è¸ªå˜åŒ–ï¼Œä½† <code>getter/setter</code> åªèƒ½è¿½è¸ªä¸€ä¸ªæ•°æ®æ˜¯å¦è¢«ä¿®æ”¹ï¼Œæ— æ³•è¿½è¸ªæ–°å¢å±æ€§å’Œåˆ é™¤å±æ€§ï¼Œæ‰€ä»¥æ‰ä¼šå¯¼è‡´ä¸Šé¢ä¾‹å­ä¸­æåˆ°çš„é—®é¢˜ã€‚</p> <p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒVue.jsæä¾›äº†ä¸¤ä¸ªAPI  -- <code>vm.$set</code> å’Œ <code>vm.$delete</code>ã€‚</p> <h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h3> <p>å˜åŒ–ä¾¦æµ‹å°±æ˜¯ä¾¦æµ‹æ•°æ®çš„å˜åŒ–ï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¦èƒ½ä¾¦æµ‹åˆ°å¹¶å‘å‡ºé€šçŸ¥ã€‚</p> <p>Object å¯èƒ½é€šè¿‡ <code>Object.defineProperty</code> å°†å±æ€§è½¬æ¢æˆ <code>getter/setter</code> çš„å½¢å¼æ¥è¿½è¸ªå˜åŒ–ï¼Œ <strong>è¯»å–</strong>æ•°æ®æ—¶ä¼šè§¦å‘ <code>getter</code>ï¼Œ<strong>ä¿®æ”¹</strong>æ•°æ®æ—¶ä¼šè§¦å‘ <code>setter</code>ã€‚</p> <p>æˆ‘ä»¬éœ€è¦åœ¨ <code>getter</code> ä¸­æ”¶é›†æœ‰å“ªäº›ä¾èµ–ä½¿ç”¨äº†æ•°æ®ã€‚å½“ <code>setter</code> è¢«è§¦å‘æ—¶ï¼Œå»é€šçŸ¥ <code>getter</code> ä¸­æ”¶é›†çš„ä¾èµ–æ•°æ®å‘ç”Ÿäº†å˜åŒ–ã€‚</p> <p>æ”¶é›†ä¾èµ–éœ€è¦ä¸ºä¾èµ–æ‰¾ä¸€ä¸ªå­˜å‚¨ä¾èµ–çš„åœ°æ–¹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº† <code>Dep</code>ï¼Œå®ƒç”¨æ¥æ”¶é›†ä¾èµ–ã€åˆ é™¤ä¾èµ–ã€å‘ä¾èµ–å‘é€æ¶ˆæ¯ç­‰ã€‚</p> <p>æ‰€è°“çš„ä¾èµ–ï¼Œå…¶å®å°±æ˜¯<code>Watcher</code>ã€‚åªæœ‰<code>Watcher</code>è§¦å‘çš„<code>getter</code>æ‰ä¼šæ”¶é›†ä¾èµ–ï¼Œå“ªä¸ª<code>Watcher</code>è§¦å‘äº†<code>getter</code>ï¼Œå°±æŠŠå“ªä¸ª<code>Watcher</code>æ”¶é›†åˆ°<code>Dep</code>ä¸­ã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå¾ªç¯ä¾èµ–åˆ—è¡¨ï¼ŒæŠŠæ‰€æœ‰çš„ Watcher éƒ½é€šçŸ¥ä¸€éã€‚</p> <p>Watcherçš„åŸç†æ˜¯ï¼Œå…ˆæŠŠè‡ªå·±è®¾ç½®åˆ°å…¨å±€å”¯ä¸€çš„æŒ‡å®šä½ç½®ï¼Œç„¶åè¯»å–æ•°æ®ã€‚å› ä¸ºè¯»å–äº†æ•°æ®ï¼Œæ‰€ä»¥ä¼šè§¦å‘è¿™ä¸ªæ•°æ®çš„getterã€‚æ¥ç€ï¼Œåœ¨getterä¸­å°±ä¼šä»å…¨å±€å”¯ä¸€çš„é‚£ä¸ªä½ç½®è¯»å–å½“å‰æ­£åœ¨è¯»å–æ•°æ®çš„Watcherï¼Œå¹¶æŠŠè¿™ä¸ªWatcheræ”¶é›†åˆ°Depä¸­å»ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼ŒWatcherå¯ä»¥ä¸»åŠ¨å»è®¢é˜…ä»»æ„ä¸€ä¸ªæ•°æ®çš„å˜åŒ–ã€‚</p> <p>æ­¤å¤–ï¼Œæˆ‘ä»¬åˆ›å»ºäº†Observerç±»ï¼Œå®ƒçš„ä½œç”¨æ˜¯æŠŠä¸€ä¸ªobjectä¸­çš„æ‰€æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬å­æ•°æ®ï¼‰éƒ½è½¬æ¢æˆå“åº”å¼çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒä¼šä¾¦æµ‹objectä¸­æ‰€æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬å­æ•°æ®ï¼‰çš„å˜åŒ–ã€‚</p> <p>ç”±äºåœ¨ES6ä¹‹å‰JavaScriptå¹¶æ²¡æœ‰æä¾›å…ƒç¼–ç¨‹çš„èƒ½åŠ›ï¼Œæ‰€ä»¥åœ¨å¯¹è±¡ä¸Šæ–°å¢å±æ€§å’Œåˆ é™¤å±æ€§éƒ½æ— æ³•è¢«è¿½è¸ªåˆ°ã€‚</p> <h2 id="ä¸‰ã€arrayçš„å˜åŒ–ä¾¦æµ‹"><a href="#ä¸‰ã€arrayçš„å˜åŒ–ä¾¦æµ‹" class="header-anchor">#</a> ä¸‰ã€Arrayçš„å˜åŒ–ä¾¦æµ‹</h2> <p>å‰é¢ä»‹ç» <code>Object</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¯´è¿‡å…¶ä¾¦æµ‹æ–¹å¼æ˜¯é€šè¿‡ <code>getter/setter</code> å®ç°çš„ã€‚</p> <p>å¦‚æœé‡åˆ° Arrayï¼Œæˆ‘ä»¬å¯ä»¥ä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p>ä½¿ç”¨äº† <code>push</code> æ–¹æ³•æ¥æ”¹å˜æ•°ç»„ï¼Œå¹¶ä¸ä¼šè§¦å‘ <code>getter/setter</code>ã€‚</p> <h3 id="å¦‚ä½•è¿½è¸ªå˜åŒ–-2"><a href="#å¦‚ä½•è¿½è¸ªå˜åŒ–-2" class="header-anchor">#</a> å¦‚ä½•è¿½è¸ªå˜åŒ–</h3> <p>åœ¨JSä¸­ï¼Œæ²¡æœ‰æä¾›å¯ä»¥æ‹¦æˆªåŸå‹æ–¹æ³•çš„èƒ½åŠ›ã€‚ä½†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è‡ªå®šä¹‰çš„æ–¹æ³•æ¥è¦†ç›–åŸç”Ÿçš„åŸå‹æ–¹æ³•ï¼ˆ<code>Array.prototype</code>ï¼‰ï¼Œæ¯å½“ä½¿ç”¨ArrayåŸå‹ä¸Šçš„æ–¹æ³•æ“ä½œæ•°ç»„æ—¶ï¼Œå…¶å®æ‰§è¡Œçš„éƒ½æ˜¯æ‹¦æˆªå™¨ä¸­æä¾›çš„æ–¹æ³•ã€‚ç„¶åï¼Œåœ¨æ‹¦æˆªå™¨ä¸­ä½¿ç”¨åŸç”ŸArrayçš„åŸå‹æ–¹æ³•å»æ“ä½œæ•°ç»„ã€‚</p> <p><img src="/assets/img/array_push.43995bcf.png" alt="array_push"></p> <h3 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="header-anchor">#</a> æ‹¦æˆªå™¨</h3> <p>åœ¨ Array åŸå‹ä¸­ï¼Œå¯ä»¥æ”¹å˜æ•°ç»„è‡ªèº«å†…å®¹çš„æ–¹æ³•æœ‰ 7 ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼š<code>push</code>ã€ <code>pop ã€</code>shift<code>ã€</code>unshift<code>ã€</code>splice<code>ã€</code>sort<code>å’Œ</code>reverse`ã€‚</p> <ul><li><code>src/core/observer/array.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*
 * not type checking this file because flow doesn't play well with
 * dynamically accessing methods on Array prototype
 */</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> def <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span>

<span class="token keyword">const</span> arrayProto <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype
<span class="token keyword">export</span> <span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>arrayProto<span class="token punctuation">)</span>

<span class="token keyword">const</span> methodsToPatch <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'push'</span><span class="token punctuation">,</span>
  <span class="token string">'pop'</span><span class="token punctuation">,</span>
  <span class="token string">'shift'</span><span class="token punctuation">,</span>
  <span class="token string">'unshift'</span><span class="token punctuation">,</span>
  <span class="token string">'splice'</span><span class="token punctuation">,</span>
  <span class="token string">'sort'</span><span class="token punctuation">,</span>
  <span class="token string">'reverse'</span>
<span class="token punctuation">]</span>

<span class="token comment">/**
 * Intercept mutating methods and emit events
 */</span>
methodsToPatch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// cache original method</span>
  <span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span>
  <span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__
    <span class="token keyword">let</span> inserted
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token operator">:</span>
      <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span>
    <span class="token comment">// notify change</span>
    ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å˜é‡ <code>arrayMethods</code>ï¼Œå®ƒç»§æ‰¿è‡ª <code>Array.prototype</code>ï¼Œå…·å¤‡å…¶åŠŸèƒ½ã€‚æœªæ¥æˆ‘ä»¬ä½¿ç”¨ <code>arrayMethods</code> å»è¦†ç›– <code>Array.prototype</code>ã€‚</p> <p>æ¥ä¸‹æ¥ï¼Œåœ¨ <code>arrayMethods</code> ä¸Šä½¿ç”¨ <code>Object.definePrototype</code>æ–¹æ³•å°†é‚£äº›å¯ä»¥æ”¹å˜æ•°ç»„è‡ªèº«å†…å®¹çš„æ–¹æ³•è¿›è¡Œå°è£…ã€‚</p> <h3 id="ä½¿ç”¨æ‹¦æˆªå™¨è¦†ç›–arrayåŸå‹"><a href="#ä½¿ç”¨æ‹¦æˆªå™¨è¦†ç›–arrayåŸå‹" class="header-anchor">#</a> ä½¿ç”¨æ‹¦æˆªå™¨è¦†ç›–ArrayåŸå‹</h3> <p>â€‹		æœ‰äº†æ‹¦æˆªå™¨ä¹‹åï¼Œæƒ³è¦è®©å®ƒç”Ÿæ•ˆï¼Œå°±éœ€è¦ä½¿ç”¨å®ƒå»è¦†ç›– <code>Array.prototype</code>ã€‚ä½†æˆ‘ä»¬ä¸èƒ½ç›´æ¥è¦†ç›–ï¼Œå› ä¸ºè¿™æ ·ä¼šæ±¡æŸ“å…¨å±€çš„ <code>Array</code>ï¼Œæˆ‘ä»¬å¸Œæœ›æ‹¦æˆªæ“ä½œåªé’ˆå¯¹é‚£äº›è¢«ä¾¦æµ‹äº†å˜åŒ–çš„æ•°æ®ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´å¸Œæœ›æ‹¦æˆªåªè¦†ç›–é‚£äº›å“åº”å¼æ•°ç»„çš„åŸå‹ã€‚</p> <ul><li><p><code>src/core/observer/index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Observer class that is attached to each observed
 * object. Once attached, the observer converts the target
 * object's property keys into getter/setters that
 * collect dependencies and dispatch updates.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> any<span class="token punctuation">;</span>
  dep<span class="token operator">:</span> Dep<span class="token punctuation">;</span>
  vmCount<span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">// number of vms that have this object as root $data</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vmCount <span class="token operator">=</span> <span class="token number">0</span>
  	<span class="token comment">// åœ¨ value ä¸Šæ–°å¢ä¸€ä¸ªä¸å¯æšä¸¾çš„å±æ€§__ob__ï¼Œè¿™ä¸ªå±æ€§çš„å€¼å°±æ˜¯å½“å‰Observerçš„å®ä¾‹</span>
    <span class="token function">def</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">'__ob__'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hasProto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">protoAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">copyAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">,</span> arrayKeys<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Walk through all properties and convert them into
   * getter/setters. This method should only be called when
   * value type is Object.
   */</span>
  <span class="token function">walk</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Observe a list of Array items.
   */</span>
  <span class="token function">observeArray</span> <span class="token punctuation">(</span><span class="token parameter">items<span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">observe</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// helpers</span>

<span class="token comment">/**
 * Augment a target Object or Array by intercepting
 * the prototype chain using __proto__
 */</span>
<span class="token keyword">function</span> <span class="token function">protoAugment</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> src<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* eslint-disable no-proto */</span>
  target<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> src
  <span class="token comment">/* eslint-enable no-proto */</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Augment a target Object or Array by defining
 * hidden properties.
 */</span>
<span class="token comment">/* istanbul ignore next */</span>
<span class="token keyword">function</span> <span class="token function">copyAugment</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> Object<span class="token punctuation">,</span> src<span class="token operator">:</span> Object<span class="token punctuation">,</span> keys<span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token function">def</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> src<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨ä¸Šé¢ä»£ç  <code>protoAugment()</code> å‡½æ•°ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€è¡Œä»£ç ï¼š<code>target.__proto__ = arrayMethods</code> ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°† æ‹¦æˆªå™¨ <code>arrayMethods</code> èµ‹å€¼ç»™ <code>target.__proto__</code>ï¼Œé€šè¿‡ <code>__proto__</code> å¯ä»¥å¾ˆå·§å¦™åœ°å®ç°è¦†ç›– <code>target</code> åŸå‹çš„åŠŸèƒ½</p></li></ul> <p><img src="/assets/img/__proto__.13aaee2c.png" alt=""></p> <p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨äº† <code>hasProto</code> æ¥åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒ <code>__proto__</code>ï¼šå¦‚æœæ”¯æŒï¼Œåˆ™ä½¿ç”¨ <code>protoAugment</code> å‡½æ•°æ¥è¦†ç›–åŸå‹ï¼›å¦‚æœä¸æ”¯æŒï¼Œåˆ™è°ƒç”¨ <code>copyAugment</code> å‡½æ•°å°†æ‹¦æˆªå™¨ä¸­çš„æ–¹æ³•æŒ‚è½½åˆ° <code>target</code>ã€‚</p> <p><img src="/assets/img/observer_constructor.5dbf0e84.png" alt=""></p> <h3 id="å¦‚ä½•æ”¶é›†ä¾èµ–"><a href="#å¦‚ä½•æ”¶é›†ä¾èµ–" class="header-anchor">#</a> å¦‚ä½•æ”¶é›†ä¾èµ–</h3> <p>åœ¨ <code>Object</code> çš„ä¾èµ–ä¸­ï¼Œå®ƒæ˜¯åœ¨ <code>defineReactive</code>ä¸­çš„ <code>getter</code> é‡Œä½¿ç”¨ <code>Dep</code> æ”¶é›†çš„ï¼Œæ¯ä¸ªkeyéƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„ <code>Dep</code> åˆ—è¡¨æ¥å­˜å‚¨ä¾èµ–ã€‚</p> <p>æ•°ç»„ä¹Ÿæ˜¯åœ¨ <code>getter</code> ä¸­æ”¶é›†ä¾èµ–çš„ï¼Œåœ¨æ‹¦æˆªå™¨ä¸­è§¦å‘ä¾èµ–ã€‚</p> <h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="header-anchor">#</a> æ€»ç»“</h3> <p>Arrayè¿½è¸ªå˜åŒ–çš„æ–¹å¼å’ŒObjectä¸ä¸€æ ·ï¼Œå› ä¸ºå®ƒæ˜¯é€šè¿‡æ–¹æ³•æ¥æ”¹å˜å†…å®¹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡åˆ›å»ºæ‹¦æˆªå™¨å»è¦†ç›–æ•°ç»„åŸå‹çš„æ–¹å¼æ¥è¿½è¸ªå˜åŒ–ã€‚</p> <p>ä¸ºäº†ä¸æ±¡æŸ“å…¨å±€ <code>Array.prototype</code>ï¼Œæˆ‘ä»¬åœ¨ <code>Observer</code> ä¸­é’ˆå¯¹é‚£äº›éœ€è¦ä¾¦æµ‹å˜åŒ–çš„æ•°ç»„ä½¿ç”¨ <code>__proto__</code> æ¥è¦†ç›–åŸå‹æ–¹æ³•ï¼Œä½† <code>__proto__</code> åœ¨ES6ä¹‹å‰å¹¶ä¸æ˜¯æ ‡å‡†å±æ€§ï¼Œä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒå®ƒã€‚</p> <p>å› æ­¤ï¼Œé’ˆå¯¹ä¸æ”¯æŒ <code>__proto__</code> å±æ€§çš„æµè§ˆå™¨ï¼Œæˆ‘ä»¬ç›´æ¥å¾ªç¯æ‹¦æˆªï¼ˆ<code>copyAugment</code>ï¼‰ï¼ŒæŠŠæ‹¦æˆªå™¨ä¸­çš„æ–¹æ³•ç›´æ¥è®¾ç½®åˆ°æ•°ç»„èº«ä¸Šæ¥æ‹¦æˆª<code>Array.prototype</code>ä¸Šçš„åŸç”Ÿæ–¹æ³•ã€‚</p> <p>Arrayæ”¶é›†ä¾èµ–çš„æ–¹å¼å’ŒObjectä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨ <code>getter</code> ä¸­æ”¶é›†ã€‚ä½†æ˜¯ï¼Œç”±äºä½¿ç”¨ä¾èµ–çš„ä½ç½®ä¸åŒï¼Œæ•°ç»„è¦åœ¨æ‹¦æˆªå™¨ä¸­å‘ä¾èµ–å‘æ¶ˆæ¯ï¼Œæ‰€ä»¥ä¾èµ–ä¸èƒ½åƒObjecté‚£æ ·ä¿å­˜åœ¨ <code>defineReactive</code>ä¸­ï¼Œè€Œæ˜¯æŠŠä¾èµ–ä¿å­˜åœ¨äº† <code>Observer</code> å®ä¾‹ä¸Šã€‚</p> <p>åœ¨<code>Observer</code>ä¸­ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªä¾¦æµ‹äº†å˜åŒ–çš„æ•°æ®éƒ½æ ‡ä¸Šäº†å°è®° <code>__ob__</code>ï¼Œå¹¶æŠŠthisï¼ˆObserverå®ä¾‹ï¼‰ä¿å­˜åœ¨ <code>__ob__</code>ä¸Šã€‚è¿™ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p> <ul><li>ä¸€æ–¹é¢æ˜¯ï¼Œä¸ºäº†æ ‡è®°æ•°æ®æ˜¯å¦è¢«ä¾¦æµ‹äº†å˜åŒ–ï¼ˆä¿è¯åŒä¸€ä¸ªæ•°æ®åªè¢«ä¾¦æµ‹ä¸€æ¬¡ï¼‰</li> <li>å¦ä¸€æ–¹é¢ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°é€šè¿‡æ•°æ®å–åˆ° <code>__ob__</code>ï¼Œä»è€Œæ‹¿åˆ° <code>Observer</code> å®ä¾‹ä¸Šä¿å­˜çš„ä¾èµ–ã€‚</li></ul> <p>å½“æ‹¦æˆªåˆ°æ•°ç»„å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå‘ä¾èµ–å‘é€é€šçŸ¥ã€‚</p> <h2 id="å››ã€å˜åŒ–ä¾¦æµ‹ç›¸å…³çš„apiå®ç°åŸç†"><a href="#å››ã€å˜åŒ–ä¾¦æµ‹ç›¸å…³çš„apiå®ç°åŸç†" class="header-anchor">#</a> å››ã€å˜åŒ–ä¾¦æµ‹ç›¸å…³çš„APIå®ç°åŸç†</h2> <h3 id="_1-vm-watch"><a href="#_1-vm-watch" class="header-anchor">#</a> 1. vm.$watch</h3> <h4 id="_1-1-ç”¨æ³•"><a href="#_1-1-ç”¨æ³•" class="header-anchor">#</a> 1.1 ç”¨æ³•</h4> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span>expOrFn<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>å‚æ•°ï¼š</p> <ul><li><code>{string | Function} expOrFn</code></li> <li><code>{Function | Object} callback</code></li> <li><code>{Object} [options]</code> <ul><li><code>{boolean} deep</code>ï¼Œå‚æ•°è®¾ç½®ä¸º trueæ—¶ï¼Œä¼šç›‘å¬å¯¹è±¡å†…éƒ¨å€¼çš„å˜åŒ–</li> <li><code>{boolean} immediate</code>ï¼Œå‚æ•°è®¾ç½®ä¸º trueæ—¶ï¼Œå°†ç«‹å³ä»¥è¡¨è¾¾å¼çš„å½“å‰å€¼è§¦å‘å›è°ƒ</li></ul></li></ul></li> <li><p>ç”¨æ³•ï¼šç”¨äºè§‚å¯Ÿä¸€ä¸ªè¡¨è¾¾å¼æˆ– <code>computed</code> å‡½æ•°åœ¨Vue.jså®ä¾‹ä¸Šçš„å˜åŒ–ã€‚å›è°ƒå‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼šä»å‚æ•°å¾—åˆ°æ–°æ•°æ®ï¼ˆnew valueï¼‰å’Œæ—§æ•°æ®ï¼ˆold valueï¼‰ã€‚è¡¨è¾¾å¼åªæ¥å—ä»¥ç‚¹åˆ†éš”çš„è·¯å¾„ï¼Œå¦‚ï¼š<code>a.b.c</code>ï¼›å¦‚æœæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¡¨è¾¾å¼ï¼Œå¯ä»¥ç”¨å‡½æ•°ä»£æ›¿è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'a.b.c'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h4 id="_1-2-watchçš„å†…éƒ¨åŸç†"><a href="#_1-2-watchçš„å†…éƒ¨åŸç†" class="header-anchor">#</a> 1.2 watchçš„å†…éƒ¨åŸç†</h4> <p><code>vm.$watch</code>å…¶å®æ˜¯å¯¹ <code>Watcher</code> çš„ä¸€ç§å°è£…ã€‚é€šè¿‡ <code>Watcher</code> å®Œå…¨å¯ä»¥å®ç° <code>vm.$watch</code>çš„åŠŸèƒ½ï¼Œä½† <code>vm.$watch</code> ä¸­çš„å‚æ•° <code>deep</code> å’Œ <code>immediate</code> æ˜¯ <code>Watcher</code> ä¸­æ‰€æ²¡æœ‰çš„ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$watch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
    <span class="token parameter">expOrFn<span class="token operator">:</span> string <span class="token operator">|</span> Function<span class="token punctuation">,</span>
    cb<span class="token operator">:</span> any<span class="token punctuation">,</span>
    options<span class="token operator">?</span><span class="token operator">:</span> Object</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>
    <span class="token keyword">const</span> vm<span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">createWatcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> expOrFn<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    options<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> expOrFn<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>immediate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> watcher<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">callback for immediate watcher &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>watcher<span class="token punctuation">.</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">unwatchFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      watcher<span class="token punctuation">.</span><span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/15/2022, 2:45:24 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0a15208b.js" defer></script><script src="/assets/js/3.1a9699b9.js" defer></script><script src="/assets/js/9.dc9e2812.js" defer></script>
  </body>
</html>
